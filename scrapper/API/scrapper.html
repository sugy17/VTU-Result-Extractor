<!DOCTYPE html>
<html>

<head>
    <title>Scrapper</title>
    <style type="text/css">
    </style>
</head>

<body>
    <center>
            Queue:<div id="queue"></div>
            url:<input type="text" id="url" value="https://results.vtu.ac.in/AS_CBCS/index.php" />
            batch:<input type="text" id="batch" value="16" />
            dept:<input type="text" id="dept" value="cs" />
            exam:<input type="text" id="exam" />
            <script>document.getElementById('exam').value = (new Date()).getFullYear();</script>
            <button onclick="start()">GO</button>
<!--            <button onclick="stats()">STATUS</button>-->
<!--            <button onclick="sendReq(api+'clear_queue', display, 'status')">CANCEL ALL JOBS</button>-->
            <button  onclick="location.href=api+'DATA'">DATA FILES</button>
            <button  onclick="location.href=api+'usn'">USN search</button>
            <br><br><b>Status:</b>
            <p id="status"></p>
            <script type="text/javascript">
                var api = "/";
                var timer;
                stats();
                timer = setInterval(stats, 10000);
                function start() {
                    url = document.getElementById('url').value;
                    batch = document.getElementById('batch').value;
                    dept = document.getElementById('dept').value;
                    exam = document.getElementById('exam').value;
                    sendReq(api + 'start' + "?url=" + url + "&dept=" + dept + "&batch=" + batch + "&exam=" + exam, display, 'status');
                }
                function stats() {
                    url = document.getElementById('url').value;
                    batch = document.getElementById('batch').value;
                    dept = document.getElementById('dept').value;
                    exam = document.getElementById('exam').value;
                    sendReq(api + 'status' + "?url=" + url + "&dept=" + dept + "&batch=" + batch + "&exam=" + exam, display, 'status');
                }
                function display(res) {
                    js = JSON.parse(res);
                    document.getElementById('status').innerHTML = 'usn:'+ (js['usn']?js['usn'] + "<br>status:"+js['status'] :'-');
                    if (js['queue'] && js['queue'].length >0)
                        document.getElementById('queue').innerHTML = js['queue'];
                    else
                        document.getElementById('queue').innerHTML = 'No jobs currently exectuting';
                    if (0)                  //add contiditon for compelete
                        clearInterval(timer);
                }

                function sendReq(url, callback, id) {
                    var xhttp = new XMLHttpRequest();
                    xhttp.onerror = function (){
                        document.getElementById(id).innerHTML = "Unable to connect to server!!";
                        document.getElementById('queue').innerHTML = "Unable to connect to server!!";
                    };
                    xhttp.onreadystatechange = function () {
                        if (this.readyState == 4 && this.status == 200) {
                            callback(this.responseText);
                        } else if (this.readyState == 3) {
                            document.getElementById(id).innerHTML = "Loading...";
                        } else if (this.status == 404) {
                            document.getElementById(id).innerHTML = "Unable to connect to server!!";
                        }
                    };
                    xhttp.open("GET", url, true);
                    xhttp.send();
                }

            </script>
        </div>
    </center>
</body>

</html>